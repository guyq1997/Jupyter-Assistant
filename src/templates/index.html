<!DOCTYPE html>
<html>
<head>
    <title>Agent Chat Interface</title>
    <!-- Add CSS dependencies first -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">
    <link rel="stylesheet" href="/static/css/styles.css">
    
    <!-- Add core dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.0.2/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
    <script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
    
    <!-- Configure marked options -->
    <script>
        marked.setOptions({
            highlight: function(code, lang) {
                if (lang && hljs.getLanguage(lang)) {
                    return hljs.highlight(code, { language: lang }).value;
                }
                return hljs.highlightAuto(code).value;
            },
            breaks: true,
            gfm: true
        });
    </script>
</head>
<body>
    <div class="container">
        <div id="notebook-section">
            <div class="notebook-header">
                <h2>Jupyter Notebook</h2>
                <div class="notebook-controls">
                    <input type="file" id="file-upload" accept=".ipynb" />
                    <button id="upload-btn" class="upload-btn">Upload Notebook</button>
                    <button id="add-cell-btn" class="notebook-btn" title="Download Notebook">
                        <i class="fas fa-download">Download</i>
                    </button>
                    <button id="save-notebook-btn" class="primary">Save Notebook</button>
                </div>
            </div>
            <div id="notebook-display">
                <div id="notebook-content"></div>
            </div>
        </div>
        <div id="messages">
            <div id="messages-resizer"></div>
            <div id="messages-header">
                <h2>Conversation</h2>
                <button id="clear-history-btn" class="control-btn" title="Clear chat history">
                    <i class="fas fa-trash"></i> Clear History
                </button>
            </div>
            <div id="messages-content">
                <!-- Messages will be added here -->
            </div>
            <div id="input-container">
                <div id="selected-cells"></div>
                <div id="input-form">
                    <input type="text" id="user-input" placeholder="Type your message here..." />
                    <button id="send-button">Send</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Load Monaco Editor first -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.47.0/min/vs/loader.js"></script>
    <script>
        // Configure AMD loader for Monaco
        require.config({
            paths: {
                'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.47.0/min/vs'
            }
        });

        window.MonacoEnvironment = {
            getWorkerUrl: function(workerId, label) {
                return `data:text/javascript;charset=utf-8,${encodeURIComponent(`
                    self.MonacoEnvironment = {
                        baseUrl: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.47.0/min/'
                    };
                    importScripts('https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.47.0/min/vs/base/worker/workerMain.js');`
                )}`;
            }
        };

        // Load Monaco Editor
        require(['vs/editor/editor.main'], function() {
            console.log('Monaco editor loaded');
            
            // Function to load scripts sequentially
            function loadScriptsSequentially(scripts) {
                return scripts.reduce((promise, script) => {
                    return promise.then(() => {
                        return new Promise((resolve) => {
                            const scriptElement = document.createElement('script');
                            scriptElement.type = 'module';
                            scriptElement.src = script;
                            scriptElement.onload = resolve;
                            document.body.appendChild(scriptElement);
                        });
                    });
                }, Promise.resolve());
            }

            // Define script groups
            const coreModules = [
                '/static/js/core/config.js',
                '/static/js/core/websocket.js',
                '/static/js/core/messageHandler.js',
                '/static/js/core/notebookIntegration.js'
            ];

            const managerModules = [
                '/static/js/managers/cell.js',
                '/static/js/managers/editor.js',
                '/static/js/managers/selection.js',
                '/static/js/managers/DiffUIManager.js',
                '/static/js/managers/BatchConfirmationManager.js'
            ];

            const mainModules = [
                '/static/js/notebook/NotebookUIBase.js',
                '/static/js/notebook/NotebookUI.js',
                '/static/js/notebook/notebook.js',
                '/static/js/ui/chat/chat.js'
            ];

            // Load all scripts in sequence
            loadScriptsSequentially([...coreModules, ...managerModules, ...mainModules])
                .then(() => {
                    console.log('All scripts loaded successfully');
                })
                .catch((error) => {
                    console.error('Error loading scripts:', error);
                });
        });
    </script>
</body>
</html> 